<!doctype html><html lang="en"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Article Viewer</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,-apple-system,sans-serif;background:#000;position:relative;color:#eee;padding:20px;overflow:scroll}.content{transform-origin:top center;max-width:70vw;margin:0 auto}.image-wrapper{margin-bottom:20px;background:#111;min-height:200px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border-radius:8px}.image-wrapper img{width:100%;height:auto;display:block;transition:transform .2s;transform-origin:center center}.loading-spinner{position:absolute;width:40px;height:40px;border:3px solid #222;border-top:3px solid #0af;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.menu-content{background-color:#111;color:#fff!important;border-radius:0 8px 8px 0;overflow:hidden;z-index:999;display:flex;align-items:center;flex-direction:column;flex-wrap:nowrap;border-radius:8px;overflow-y:hidden;border:1px solid #555;gap:1em;max-width:fit-content}.show{animation:expandMenu 5s forwards}.icon-btn{background:0 0;border:none;width:48px;height:48px;cursor:pointer;color:#fff}@keyframes expandMenu{0%{max-height:0}100%{max-height:100%}}.menu-toggle{width:48px;height:48px;background-color:#111;color:#fff;outline:0;border:1px solid #555;border-radius:8px}svg{max-width:32px;max-height:32px}.progress-ring{display:none}.floating-menu{display:flex;flex-direction:column;transition:all .5s ease;max-width:fit-content;position:fixed;top:16px;z-index:999;right:16px}.menu-row{display:flex;flex-direction:column;align-items:center}.page-mini{position:fixed;display:none;top:8px;left:0;right:0;margin-inline:auto;z-index:100;width:fit-content;background-color:#111;border:1px solid #555;border-radius:8px;padding:8px}.page-input-mini{max-width:3em}.links-panel{display:none}hr{width:100%}</style><span class="page-mini"></span><div class="floating-menu" aria-live="polite"><button class="menu-toggle" style="display:none" id="menuToggle" aria-expanded="false" aria-controls="menuContent" title="Open menu"><svg class="progress-ring" width="76" height="76" viewBox="0 0 66 66" aria-hidden="true"><rect class="progress-ring-circle" id="progressCircle" x="3" y="3" width="60" height="60" stroke-dasharray="188.5" stroke-dashoffset="188.5"></rect></svg><div class="toggle-content"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v2H4V6zm0 5h16v2H4v-2zm16 5H4v2h16v-2z" fill="currentColor"/></svg></div></button><div class="menu-content" id="menuContent" role="menu" aria-hidden="true"><div class="menu-row"><button class="icon-btn" id="prevPage" title="Previous page" aria-label="Previous page"><svg style="rotate:90deg" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 5v2h-2V5h2zm-4 4V7h2v2h-2zm-2 2V9h2v2h-2zm0 2H8v-2h2v2zm2 2v-2h-2v2h2zm0 0h2v2h-2v-2zm4 4v-2h-2v2h2z" fill="currentColor"/></svg></button> <button class="icon-btn" id="nextPage" title="Next page" aria-label="Next page"><svg style="rotate:90deg" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v2h2V5H8zm4 4V7h-2v2h2zm2 2V9h-2v2h2zm0 2h2v-2h-2v2zm-2 2v-2h2v2h-2zm0 0h-2v2h2v-2zm-4 4v-2h2v2H8z" fill="currentColor"/></svg></button></div><div class="menu-row" style="gap:.3em"><input id="pageInput" class="page-input-mini" type="number" min="1" value="1" aria-label="Page input"><hr><span id="pageCount" class="page-count-mini">0</span></div><div class="menu-row"><button class="icon-btn" id="zoomOut" title="Zoom out" aria-label="Zoom out"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 2H6v2H4v2H2v8h2v2h2v2h8v-2h2v2h2v2h2v2h2v-2h-2v-2h-2v-2h-2v-2h2V6h-2V4h-2V2zm0 2v2h2v8h-2v2H6v-2H4V6h2V4h8zm0 5v2H6V9h8z" fill="currentColor"/></svg> <button class="icon-btn" id="zoomReset" title="Reset zoom" aria-label="Reset zoom">100%</button> <button class="icon-btn" id="zoomIn" title="Zoom in" aria-label="Zoom in"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 2H6v2H4v2H2v8h2v2h2v2h8v-2h2v2h2v2h2v2h2v-2h-2v-2h-2v-2h-2v-2h2V6h-2V4h-2V2zm0 2v2h2v8h-2v2H6v-2H4V6h2V4h8zM9 6h2v3h3v2h-3v3H9v-3H6V9h3V6z" fill="currentColor"/></svg></button></button></div><div class="menu-row"><button class="icon-btn" id="toggleMagnifier" title="Toggle magnifier" aria-pressed="false" aria-label="Toggle magnifier"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2h8v2H6V2zM4 6V4h2v2H4zm0 8H2V6h2v8zm2 2H4v-2h2v2zm8 0v2H6v-2h8zm2-2h-2v2h2v2h2v2h2v2h2v-2h-2v-2h-2v-2h-2v-2zm0-8h2v8h-2V6zm0 0V4h-2v2h2z" fill="currentColor"/></svg></button> <button class="icon-btn" id="toggleLinks" title="Toggle links panel" aria-pressed="false" aria-label="Toggle links"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h7v2H4v8h7v2H2V6h2zm16 0h-7v2h7v8h-7v2h9V6h-2zm-3 5H7v2h10v-2z" fill="currentColor"/></svg></button> <button class="icon-btn" id="downloadPdf" title="Download PDF" aria-label="Download PDF"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 17V3h-2v10H9v-2H7v2h2v2h2v2h2zm8 2v-4h-2v4H5v-4H3v6h18v-2zm-8-6v2h2v-2h2v-2h-2v2h-2z" fill="currentColor"/></svg></button></div></div></div><div class="links-panel" id="linksPanel"><h3>Links</h3><div id="linksList">Loading...</div></div><div class="content" id="imagesContainer"></div><div class="magnifier" id="magnifier"><img id="magnifierImg" src="" alt=""></div><script>const urlParams=new URLSearchParams(window.location.search),article=urlParams.get("article")||"default",pageCount=parseInt(urlParams.get("pagecount"))||1;let baseUrl=urlParams.get("baseurl");if(!baseUrl){const e=window.location.pathname,t=e.substring(0,e.lastIndexOf("/")+1);baseUrl=window.location.origin+t}baseUrl.endsWith("/")||(baseUrl+="/");const renderPath=`../.render/${article}/`,pdfUrl=`../${article}.pdf`;let magnifierEnabled=!1,currentZoom=1;const magnifier=document.getElementById("magnifier"),magnifierImg=document.getElementById("magnifierImg"),progressCircle=document.getElementById("progressCircle"),circumference=2*Math.PI*30;function applyZoom(){document.querySelectorAll(".content").forEach(e=>{e.style.transform=`scale(${currentZoom})`}),document.getElementById("zoomReset").textContent=`${Math.round(100*currentZoom)}%`}function updateProgress(e){const t=circumference-e*circumference;progressCircle.style.strokeDashoffset=t}function scrollToPage(e){const t=document.querySelectorAll(".image-wrapper"),n=e-1;e>=1&&e<=pageCount&&t[n]&&(t[n].scrollIntoView({behavior:"smooth",block:"center"}),document.getElementById("pageInput").value=e,updateProgress(e))}async function loadLinks(){const e=baseUrl+renderPath+"links.txt",t=document.getElementById("linksList");try{const n=await fetch(e);if(!n.ok)throw new Error("Failed to load links");const o=(await n.text()).split("\n").filter(e=>e.trim());if(0===o.length)return void(t.innerHTML="<em>No links found</em>");t.innerHTML=o.map(e=>`<a href="${e.trim()}" target="_blank" rel="noopener noreferrer">${e.trim()}</a>`).join("")}catch(e){t.innerHTML='<div class="error">Error loading links</div>'}}function loadImages(){const e=document.getElementById("imagesContainer");for(let t=0;t<=pageCount;t++){const n=baseUrl+renderPath+`p${t.toString().padStart(3,"0")}.avif`,o=document.createElement("div");o.className="image-wrapper",o.innerHTML=`\n                    <div class="loading-spinner"></div>\n                    <img class="page-image" data-src="${n}" alt="Page ${t+1}">\n                `,e.appendChild(o)}const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target,o=n.parentElement,a=o.querySelector(".loading-spinner");n.src=n.dataset.src,n.onload=()=>{a&&a.remove()},n.onerror=()=>{a&&a.remove(),o.innerHTML='<div class="error">Failed to load image</div>'},t.unobserve(n)}})},{rootMargin:"50px"});document.querySelectorAll("img[data-src]").forEach(e=>{t.observe(e)})}document.getElementById("pageCount").textContent=`${pageCount}`,document.getElementById("menuToggle").addEventListener("click",()=>{document.getElementById("menuContent").classList.toggle("show")}),document.addEventListener("click",e=>{document.querySelector(".floating-menu").contains(e.target)||document.getElementById("menuContent").classList.remove("show")}),document.getElementById("toggleMagnifier").addEventListener("click",()=>{magnifierEnabled=!magnifierEnabled,document.getElementById("toggleMagnifier").classList.toggle("active",magnifierEnabled),magnifierEnabled||(magnifier.style.display="none")}),document.getElementById("toggleLinks").addEventListener("click",()=>{document.getElementById("linksPanel").classList.toggle("show"),document.getElementById("toggleLinks").classList.toggle("active")}),document.getElementById("downloadPdf").addEventListener("click",()=>{window.open(pdfUrl,"_blank")}),document.getElementById("zoomIn").addEventListener("click",()=>{currentZoom=Math.min(currentZoom+.25,3),applyZoom()}),document.getElementById("zoomOut").addEventListener("click",()=>{currentZoom=Math.max(currentZoom-.25,.5),applyZoom()}),document.getElementById("zoomReset").addEventListener("click",()=>{currentZoom=1,applyZoom()}),document.getElementById("prevPage").addEventListener("click",()=>{const e=parseInt(document.getElementById("pageInput").value)||1;scrollToPage(Math.max(1,e-1))}),document.getElementById("nextPage").addEventListener("click",()=>{const e=parseInt(document.getElementById("pageInput").value)||1;scrollToPage(Math.min(pageCount,e+1))}),document.getElementById("pageInput").addEventListener("change",e=>{scrollToPage(parseInt(e.target.value))}),document.getElementById("pageInput").addEventListener("keypress",e=>{"Enter"===e.key&&scrollToPage(parseInt(e.target.value))}),window.addEventListener("scroll",()=>{const e=window.scrollY,t=document.body.scrollHeight-window.innerHeight,n=Math.min(Math.max(e/t,0),1);updateProgress(n);const o=Math.floor(n*pageCount)+1;document.getElementById("pageInput").value=Math.min(o,pageCount)}),document.addEventListener("mousemove",e=>{if(!magnifierEnabled)return void(magnifier.style.display="none");const t=e.target;if("IMG"===t.tagName&&t.classList.contains("page-image")){magnifier.style.display="block";const n=t.getBoundingClientRect(),o=e.clientX-n.left,a=e.clientY-n.top,r=400,i=300;magnifier.style.left=e.clientX-r/2+"px",magnifier.style.top=e.clientY-i/2+"px";const l=2.5,s=t.naturalWidth,c=t.naturalHeight;magnifierImg.src=t.src,magnifierImg.style.width=s*l+"px",magnifierImg.style.height=c*l+"px";const d=o/n.width,m=a/n.height;magnifierImg.style.left=-(d*s*l-r/2)+"px",magnifierImg.style.top=-(m*c*l-i/2)+"px"}else magnifier.style.display="none"}),loadLinks(),loadImages(),updateProgress(1)</script>