<span style="color:#0057ae">void</span> <span style="color:#010181">DrawBillboardPro</span><span style="color:#000000">(</span>Camera camera<span style="color:#000000">,</span> Texture2D texture<span style="color:#000000">,</span> Rectangle source<span style="color:#000000">,</span> Vector3 position<span style="color:#000000">,</span> Vector3 up<span style="color:#000000">,</span> Vector2 size<span style="color:#000000">,</span> Vector2 origin<span style="color:#000000">,</span> <span style="color:#0057ae">float</span> rotation<span style="color:#000000">,</span> Color tint<span style="color:#000000">){</span>
    <span style="color:#838183; font-style:italic">// NOTE: Billboard size will maintain source rectangle aspect ratio, size will represent billboard width</span>
    Vector2 sizeRatio <span style="color:#000000">= {</span> size<span style="color:#000000">.</span>x<span style="color:#000000">*(</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>source<span style="color:#000000">.</span>width<span style="color:#000000">/</span>source<span style="color:#000000">.</span>height<span style="color:#000000">,</span> size<span style="color:#000000">.</span>y <span style="color:#000000">};</span>
    Matrix matView <span style="color:#000000">=</span> <span style="color:#010181">MatrixLookAt</span><span style="color:#000000">(</span>camera<span style="color:#000000">.</span>position<span style="color:#000000">,</span> camera<span style="color:#000000">.</span>target<span style="color:#000000">,</span> camera<span style="color:#000000">.</span>up<span style="color:#000000">);</span>
    Vector3 right <span style="color:#000000">= {</span> matView<span style="color:#000000">.</span>m0<span style="color:#000000">,</span> matView<span style="color:#000000">.</span>m4<span style="color:#000000">,</span> matView<span style="color:#000000">.</span>m8 <span style="color:#000000">};</span>
    <span style="color:#838183; font-style:italic">//Vector3 up = { matView.m1, matView.m5, matView.m9 };</span>
    Vector3 rightScaled <span style="color:#000000">=</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> sizeRatio<span style="color:#000000">.</span>x<span style="color:#000000">/</span><span style="color:#b07e00">2</span><span style="color:#000000">);</span>
    Vector3 upScaled <span style="color:#000000">=</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> sizeRatio<span style="color:#000000">.</span>y<span style="color:#000000">/</span><span style="color:#b07e00">2</span><span style="color:#000000">);</span>
    Vector3 p1 <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span>rightScaled<span style="color:#000000">,</span> upScaled<span style="color:#000000">);</span>
    Vector3 p2 <span style="color:#000000">=</span> <span style="color:#010181">Vector3Subtract</span><span style="color:#000000">(</span>rightScaled<span style="color:#000000">,</span> upScaled<span style="color:#000000">);</span>
    Vector3 topLeft <span style="color:#000000">=</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>p2<span style="color:#000000">, -</span><span style="color:#b07e00">1</span><span style="color:#000000">);</span>
    Vector3 topRight <span style="color:#000000">=</span> p1<span style="color:#000000">;</span>
    Vector3 bottomRight <span style="color:#000000">=</span> p2<span style="color:#000000">;</span>
    Vector3 bottomLeft <span style="color:#000000">=</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>p1<span style="color:#000000">, -</span><span style="color:#b07e00">1</span><span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span>rotation <span style="color:#000000">!=</span> <span style="color:#b07e00">0.0</span>f<span style="color:#000000">)</span>
    <span style="color:#000000">{</span>
        <span style="color:#0057ae">float</span> sinRotation <span style="color:#000000">=</span> <span style="color:#010181">sinf</span><span style="color:#000000">(</span>rotation<span style="color:#000000">*</span>DEG2RAD<span style="color:#000000">);</span>
        <span style="color:#0057ae">float</span> cosRotation <span style="color:#000000">=</span> <span style="color:#010181">cosf</span><span style="color:#000000">(</span>rotation<span style="color:#000000">*</span>DEG2RAD<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// NOTE: (-1, 1) is the range where origin.x, origin.y is inside the texture</span>
        <span style="color:#0057ae">float</span> rotateAboutX <span style="color:#000000">=</span> sizeRatio<span style="color:#000000">.</span>x<span style="color:#000000">*</span>origin<span style="color:#000000">.</span>x<span style="color:#000000">/</span><span style="color:#b07e00">2</span><span style="color:#000000">;</span>
        <span style="color:#0057ae">float</span> rotateAboutY <span style="color:#000000">=</span> sizeRatio<span style="color:#000000">.</span>y<span style="color:#000000">*</span>origin<span style="color:#000000">.</span>y<span style="color:#000000">/</span><span style="color:#b07e00">2</span><span style="color:#000000">;</span>
        <span style="color:#0057ae">float</span> xtvalue<span style="color:#000000">,</span> ytvalue<span style="color:#000000">;</span>
        <span style="color:#0057ae">float</span> rotatedX<span style="color:#000000">,</span> rotatedY<span style="color:#000000">;</span>
        xtvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> topLeft<span style="color:#000000">) -</span> rotateAboutX<span style="color:#000000">;</span> <span style="color:#838183; font-style:italic">// Project points to x and y coordinates on the billboard plane</span>
        ytvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> topLeft<span style="color:#000000">) -</span> rotateAboutY<span style="color:#000000">;</span>
        rotatedX <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">-</span> ytvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> rotateAboutX<span style="color:#000000">;</span> <span style="color:#838183; font-style:italic">// Rotate about the point origin</span>
        rotatedY <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> ytvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">+</span> rotateAboutY<span style="color:#000000">;</span>
        topLeft <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span><span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> rotatedY<span style="color:#000000">),</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> rotatedX<span style="color:#000000">));</span> <span style="color:#838183; font-style:italic">// Translate back to cartesian coordinates</span>
        xtvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> topRight<span style="color:#000000">) -</span> rotateAboutX<span style="color:#000000">;</span>
        ytvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> topRight<span style="color:#000000">) -</span> rotateAboutY<span style="color:#000000">;</span>
        rotatedX <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">-</span> ytvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> rotateAboutX<span style="color:#000000">;</span>
        rotatedY <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> ytvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">+</span> rotateAboutY<span style="color:#000000">;</span>
        topRight <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span><span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> rotatedY<span style="color:#000000">),</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> rotatedX<span style="color:#000000">));</span>
        xtvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> bottomRight<span style="color:#000000">) -</span> rotateAboutX<span style="color:#000000">;</span>
        ytvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> bottomRight<span style="color:#000000">) -</span> rotateAboutY<span style="color:#000000">;</span>
        rotatedX <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">-</span> ytvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> rotateAboutX<span style="color:#000000">;</span>
        rotatedY <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> ytvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">+</span> rotateAboutY<span style="color:#000000">;</span>
        bottomRight <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span><span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> rotatedY<span style="color:#000000">),</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> rotatedX<span style="color:#000000">));</span>
        xtvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> bottomLeft<span style="color:#000000">)-</span>rotateAboutX<span style="color:#000000">;</span>
        ytvalue <span style="color:#000000">=</span> <span style="color:#010181">Vector3DotProduct</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> bottomLeft<span style="color:#000000">)-</span>rotateAboutY<span style="color:#000000">;</span>
        rotatedX <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">-</span> ytvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> rotateAboutX<span style="color:#000000">;</span>
        rotatedY <span style="color:#000000">=</span> xtvalue<span style="color:#000000">*</span>sinRotation <span style="color:#000000">+</span> ytvalue<span style="color:#000000">*</span>cosRotation <span style="color:#000000">+</span> rotateAboutY<span style="color:#000000">;</span>
        bottomLeft <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span><span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>up<span style="color:#000000">,</span> rotatedY<span style="color:#000000">),</span> <span style="color:#010181">Vector3Scale</span><span style="color:#000000">(</span>right<span style="color:#000000">,</span> rotatedX<span style="color:#000000">));</span>
    <span style="color:#000000">}</span>
    <span style="color:#838183; font-style:italic">// Translate points to the draw center (position)</span>
    topLeft <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span>topLeft<span style="color:#000000">,</span> position<span style="color:#000000">);</span>
    topRight <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span>topRight<span style="color:#000000">,</span> position<span style="color:#000000">);</span>
    bottomRight <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span>bottomRight<span style="color:#000000">,</span> position<span style="color:#000000">);</span>
    bottomLeft <span style="color:#000000">=</span> <span style="color:#010181">Vector3Add</span><span style="color:#000000">(</span>bottomLeft<span style="color:#000000">,</span> position<span style="color:#000000">);</span>
    <span style="color:#010181">rlSetTexture</span><span style="color:#000000">(</span>texture<span style="color:#000000">.</span>id<span style="color:#000000">);</span>
    <span style="color:#010181">rlBegin</span><span style="color:#000000">(</span>RL_QUADS<span style="color:#000000">);</span>
        <span style="color:#010181">rlColor4ub</span><span style="color:#000000">(</span>tint<span style="color:#000000">.</span>r<span style="color:#000000">,</span> tint<span style="color:#000000">.</span>g<span style="color:#000000">,</span> tint<span style="color:#000000">.</span>b<span style="color:#000000">,</span> tint<span style="color:#000000">.</span>a<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// Bottom-left corner for texture and quad</span>
        <span style="color:#010181">rlTexCoord2f</span><span style="color:#000000">((</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>source<span style="color:#000000">.</span>x<span style="color:#000000">/</span>texture<span style="color:#000000">.</span>width<span style="color:#000000">, (</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>source<span style="color:#000000">.</span>y<span style="color:#000000">/</span>texture<span style="color:#000000">.</span>height<span style="color:#000000">);</span>
        <span style="color:#010181">rlVertex3f</span><span style="color:#000000">(</span>topLeft<span style="color:#000000">.</span>x<span style="color:#000000">,</span> topLeft<span style="color:#000000">.</span>y<span style="color:#000000">,</span> topLeft<span style="color:#000000">.</span>z<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// Top-left corner for texture and quad</span>
        <span style="color:#010181">rlTexCoord2f</span><span style="color:#000000">((</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>source<span style="color:#000000">.</span>x<span style="color:#000000">/</span>texture<span style="color:#000000">.</span>width<span style="color:#000000">, (</span><span style="color:#0057ae">float</span><span style="color:#000000">)(</span>source<span style="color:#000000">.</span>y <span style="color:#000000">+</span> source<span style="color:#000000">.</span>height<span style="color:#000000">)/</span>texture<span style="color:#000000">.</span>height<span style="color:#000000">);</span>
        <span style="color:#010181">rlVertex3f</span><span style="color:#000000">(</span>bottomLeft<span style="color:#000000">.</span>x<span style="color:#000000">,</span> bottomLeft<span style="color:#000000">.</span>y<span style="color:#000000">,</span> bottomLeft<span style="color:#000000">.</span>z<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// Top-right corner for texture and quad</span>
        <span style="color:#010181">rlTexCoord2f</span><span style="color:#000000">((</span><span style="color:#0057ae">float</span><span style="color:#000000">)(</span>source<span style="color:#000000">.</span>x <span style="color:#000000">+</span> source<span style="color:#000000">.</span>width<span style="color:#000000">)/</span>texture<span style="color:#000000">.</span>width<span style="color:#000000">, (</span><span style="color:#0057ae">float</span><span style="color:#000000">)(</span>source<span style="color:#000000">.</span>y <span style="color:#000000">+</span> source<span style="color:#000000">.</span>height<span style="color:#000000">)/</span>texture<span style="color:#000000">.</span>height<span style="color:#000000">);</span>
        <span style="color:#010181">rlVertex3f</span><span style="color:#000000">(</span>bottomRight<span style="color:#000000">.</span>x<span style="color:#000000">,</span> bottomRight<span style="color:#000000">.</span>y<span style="color:#000000">,</span> bottomRight<span style="color:#000000">.</span>z<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// Bottom-right corner for texture and quad</span>
        <span style="color:#010181">rlTexCoord2f</span><span style="color:#000000">((</span><span style="color:#0057ae">float</span><span style="color:#000000">)(</span>source<span style="color:#000000">.</span>x <span style="color:#000000">+</span> source<span style="color:#000000">.</span>width<span style="color:#000000">)/</span>texture<span style="color:#000000">.</span>width<span style="color:#000000">, (</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>source<span style="color:#000000">.</span>y<span style="color:#000000">/</span>texture<span style="color:#000000">.</span>height<span style="color:#000000">);</span>
        <span style="color:#010181">rlVertex3f</span><span style="color:#000000">(</span>topRight<span style="color:#000000">.</span>x<span style="color:#000000">,</span> topRight<span style="color:#000000">.</span>y<span style="color:#000000">,</span> topRight<span style="color:#000000">.</span>z<span style="color:#000000">);</span>
    <span style="color:#010181">rlEnd</span><span style="color:#000000">();</span>
    <span style="color:#010181">rlSetTexture</span><span style="color:#000000">(</span><span style="color:#b07e00">0</span><span style="color:#000000">);</span>
<span style="color:#000000">}</span>
