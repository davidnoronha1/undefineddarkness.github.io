FilePathList <span style="color:#010181">LoadDirectoryFiles</span><span style="color:#000000">(</span><span style="color:#0057ae">const char</span> <span style="color:#000000">*</span>dirPath<span style="color:#000000">){</span>
    FilePathList files <span style="color:#000000">= {</span> <span style="color:#b07e00">0</span> <span style="color:#000000">};</span>
    <span style="color:#0057ae">unsigned int</span> fileCounter <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">struct</span> dirent <span style="color:#000000">*</span>entity<span style="color:#000000">;</span>
    <span style="color:#0057ae">DIR</span> <span style="color:#000000">*</span>dir <span style="color:#000000">=</span> <span style="color:#010181">opendir</span><span style="color:#000000">(</span>dirPath<span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span>dir <span style="color:#000000">!=</span> NULL<span style="color:#000000">)</span> <span style="color:#838183; font-style:italic">// It&apos;s a directory</span>
    <span style="color:#000000">{</span>
        <span style="color:#838183; font-style:italic">// SCAN 1: Count files</span>
        <span style="color:#000000; font-weight:bold">while</span> <span style="color:#000000">((</span>entity <span style="color:#000000">=</span> <span style="color:#010181">readdir</span><span style="color:#000000">(</span>dir<span style="color:#000000">)) !=</span> NULL<span style="color:#000000">)</span>
        <span style="color:#000000">{</span>
            <span style="color:#838183; font-style:italic">// NOTE: We skip &apos;.&apos; (current dir) and &apos;..&apos; (parent dir) filepaths</span>
            <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">((</span><span style="color:#010181">strcmp</span><span style="color:#000000">(</span>entity<span style="color:#000000">-&gt;</span>d_name<span style="color:#000000">,</span> <span style="color:#bf0303">&quot;.&quot;</span><span style="color:#000000">) !=</span> <span style="color:#b07e00">0</span><span style="color:#000000">) &amp;&amp; (</span><span style="color:#010181">strcmp</span><span style="color:#000000">(</span>entity<span style="color:#000000">-&gt;</span>d_name<span style="color:#000000">,</span> <span style="color:#bf0303">&quot;..&quot;</span><span style="color:#000000">) !=</span> <span style="color:#b07e00">0</span><span style="color:#000000">))</span> fileCounter<span style="color:#000000">++;</span>
        <span style="color:#000000">}</span>
        <span style="color:#838183; font-style:italic">// Memory allocation for dirFileCount</span>
        files<span style="color:#000000">.</span>capacity <span style="color:#000000">=</span> fileCounter<span style="color:#000000">;</span>
        files<span style="color:#000000">.</span>paths <span style="color:#000000">= (</span><span style="color:#0057ae">char</span> <span style="color:#000000">**)</span><span style="color:#010181">RL_MALLOC</span><span style="color:#000000">(</span>files<span style="color:#000000">.</span>capacity<span style="color:#000000">*</span><span style="color:#000000; font-weight:bold">sizeof</span><span style="color:#000000">(</span><span style="color:#0057ae">char</span> <span style="color:#000000">*));</span>
        <span style="color:#000000; font-weight:bold">for</span> <span style="color:#000000">(</span><span style="color:#0057ae">unsigned int</span> i <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span> i <span style="color:#000000">&lt;</span> files<span style="color:#000000">.</span>capacity<span style="color:#000000">;</span> i<span style="color:#000000">++)</span> files<span style="color:#000000">.</span>paths<span style="color:#000000">[</span>i<span style="color:#000000">] = (</span><span style="color:#0057ae">char</span> <span style="color:#000000">*)</span><span style="color:#010181">RL_MALLOC</span><span style="color:#000000">(</span>MAX_FILEPATH_LENGTH<span style="color:#000000">*</span><span style="color:#000000; font-weight:bold">sizeof</span><span style="color:#000000">(</span><span style="color:#0057ae">char</span><span style="color:#000000">));</span>
        <span style="color:#010181">closedir</span><span style="color:#000000">(</span>dir<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// SCAN 2: Read filepaths</span>
        <span style="color:#838183; font-style:italic">// NOTE: Directory paths are also registered</span>
        <span style="color:#010181">ScanDirectoryFiles</span><span style="color:#000000">(</span>dirPath<span style="color:#000000">, &amp;</span>files<span style="color:#000000">,</span> NULL<span style="color:#000000">);</span>
        <span style="color:#838183; font-style:italic">// Security check: read files.count should match fileCounter</span>
        <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span>files<span style="color:#000000">.</span>count <span style="color:#000000">!=</span> files<span style="color:#000000">.</span>capacity<span style="color:#000000">)</span> <span style="color:#010181">TRACELOG</span><span style="color:#000000">(</span>LOG_WARNING<span style="color:#000000">,</span> <span style="color:#bf0303">&quot;FILEIO: Read files count do not match capacity allocated&quot;</span><span style="color:#000000">);</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">else</span> <span style="color:#010181">TRACELOG</span><span style="color:#000000">(</span>LOG_WARNING<span style="color:#000000">,</span> <span style="color:#bf0303">&quot;FILEIO: Failed to open requested directory&quot;</span><span style="color:#000000">);</span>  <span style="color:#838183; font-style:italic">// Maybe it&apos;s a file...</span>
    <span style="color:#000000; font-weight:bold">return</span> files<span style="color:#000000">;</span>
<span style="color:#000000">}</span>
