Font <span style="color:#010181">LoadFontFromImage</span><span style="color:#000000">(</span>Image image<span style="color:#000000">,</span> Color key<span style="color:#000000">,</span> <span style="color:#0057ae">int</span> firstChar<span style="color:#000000">){</span>
<span style="color:#008200">#ifndef MAX_GLYPHS_FROM_IMAGE</span>
    <span style="color:#008200">#define MAX_GLYPHS_FROM_IMAGE   256</span>     <span style="color:#838183; font-style:italic">// Maximum number of glyphs supported on image scan</span>
<span style="color:#008200"></span><span style="color:#008200">#endif</span>
    <span style="color:#008200">#define COLOR_EQUAL(col1, col2) ((col1.r == col2.r) &amp;&amp; (col1.g == col2.g) &amp;&amp; (col1.b == col2.b) &amp;&amp; (col1.a == col2.a))</span>
    Font font <span style="color:#000000">=</span> <span style="color:#010181">GetFontDefault</span><span style="color:#000000">();</span>
    <span style="color:#0057ae">int</span> charSpacing <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> lineSpacing <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> x <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> y <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// We allocate a temporal arrays for chars data measures,</span>
    <span style="color:#838183; font-style:italic">// once we get the actual number of chars, we copy data to a sized arrays</span>
    <span style="color:#0057ae">int</span> tempCharValues<span style="color:#000000">[</span>MAX_GLYPHS_FROM_IMAGE<span style="color:#000000">] = {</span> <span style="color:#b07e00">0</span> <span style="color:#000000">};</span>
    Rectangle tempCharRecs<span style="color:#000000">[</span>MAX_GLYPHS_FROM_IMAGE<span style="color:#000000">] = {</span> <span style="color:#b07e00">0</span> <span style="color:#000000">};</span>
    Color <span style="color:#000000">*</span>pixels <span style="color:#000000">=</span> <span style="color:#010181">LoadImageColors</span><span style="color:#000000">(</span>image<span style="color:#000000">);</span>
    <span style="color:#838183; font-style:italic">// Parse image data to get charSpacing and lineSpacing</span>
    <span style="color:#000000; font-weight:bold">for</span> <span style="color:#000000">(</span>y <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span> y <span style="color:#000000">&lt;</span> image<span style="color:#000000">.</span>height<span style="color:#000000">;</span> y<span style="color:#000000">++)</span>
    <span style="color:#000000">{</span>
        <span style="color:#000000; font-weight:bold">for</span> <span style="color:#000000">(</span>x <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span> x <span style="color:#000000">&lt;</span> image<span style="color:#000000">.</span>width<span style="color:#000000">;</span> x<span style="color:#000000">++)</span>
        <span style="color:#000000">{</span>
            <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(!</span><span style="color:#010181">COLOR_EQUAL</span><span style="color:#000000">(</span>pixels<span style="color:#000000">[</span>y<span style="color:#000000">*</span>image<span style="color:#000000">.</span>width <span style="color:#000000">+</span> x<span style="color:#000000">],</span> key<span style="color:#000000">))</span> <span style="color:#000000; font-weight:bold">break</span><span style="color:#000000">;</span>
        <span style="color:#000000">}</span>
        <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(!</span><span style="color:#010181">COLOR_EQUAL</span><span style="color:#000000">(</span>pixels<span style="color:#000000">[</span>y<span style="color:#000000">*</span>image<span style="color:#000000">.</span>width <span style="color:#000000">+</span> x<span style="color:#000000">],</span> key<span style="color:#000000">))</span> <span style="color:#000000; font-weight:bold">break</span><span style="color:#000000">;</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">((</span>x <span style="color:#000000">==</span> <span style="color:#b07e00">0</span><span style="color:#000000">) || (</span>y <span style="color:#000000">==</span> <span style="color:#b07e00">0</span><span style="color:#000000">))</span> <span style="color:#000000; font-weight:bold">return</span> font<span style="color:#000000">;</span>
    charSpacing <span style="color:#000000">=</span> x<span style="color:#000000">;</span>
    lineSpacing <span style="color:#000000">=</span> y<span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> charHeight <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> j <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#000000; font-weight:bold">while</span> <span style="color:#000000">(!</span><span style="color:#010181">COLOR_EQUAL</span><span style="color:#000000">(</span>pixels<span style="color:#000000">[(</span>lineSpacing <span style="color:#000000">+</span> j<span style="color:#000000">)*</span>image<span style="color:#000000">.</span>width <span style="color:#000000">+</span> charSpacing<span style="color:#000000">],</span> key<span style="color:#000000">))</span> j<span style="color:#000000">++;</span>
    charHeight <span style="color:#000000">=</span> j<span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// Check array values to get characters: value, x, y, w, h</span>
    <span style="color:#0057ae">int</span> index <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> lineToRead <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#0057ae">int</span> xPosToRead <span style="color:#000000">=</span> charSpacing<span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// Parse image data to get rectangle sizes</span>
    <span style="color:#000000; font-weight:bold">while</span> <span style="color:#000000">((</span>lineSpacing <span style="color:#000000">+</span> lineToRead<span style="color:#000000">*(</span>charHeight <span style="color:#000000">+</span> lineSpacing<span style="color:#000000">)) &lt;</span> image<span style="color:#000000">.</span>height<span style="color:#000000">)</span>
    <span style="color:#000000">{</span>
        <span style="color:#000000; font-weight:bold">while</span> <span style="color:#000000">((</span>xPosToRead <span style="color:#000000">&lt;</span> image<span style="color:#000000">.</span>width<span style="color:#000000">) &amp;&amp;</span>
              <span style="color:#000000">!</span><span style="color:#010181">COLOR_EQUAL</span><span style="color:#000000">((</span>pixels<span style="color:#000000">[(</span>lineSpacing <span style="color:#000000">+ (</span>charHeight<span style="color:#000000">+</span>lineSpacing<span style="color:#000000">)*</span>lineToRead<span style="color:#000000">)*</span>image<span style="color:#000000">.</span>width <span style="color:#000000">+</span> xPosToRead<span style="color:#000000">]),</span> key<span style="color:#000000">))</span>
        <span style="color:#000000">{</span>
            tempCharValues<span style="color:#000000">[</span>index<span style="color:#000000">] =</span> firstChar <span style="color:#000000">+</span> index<span style="color:#000000">;</span>
            tempCharRecs<span style="color:#000000">[</span>index<span style="color:#000000">].</span>x <span style="color:#000000">= (</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>xPosToRead<span style="color:#000000">;</span>
            tempCharRecs<span style="color:#000000">[</span>index<span style="color:#000000">].</span>y <span style="color:#000000">= (</span><span style="color:#0057ae">float</span><span style="color:#000000">)(</span>lineSpacing <span style="color:#000000">+</span> lineToRead<span style="color:#000000">*(</span>charHeight <span style="color:#000000">+</span> lineSpacing<span style="color:#000000">));</span>
            tempCharRecs<span style="color:#000000">[</span>index<span style="color:#000000">].</span>height <span style="color:#000000">= (</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>charHeight<span style="color:#000000">;</span>
            <span style="color:#0057ae">int</span> charWidth <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
            <span style="color:#000000; font-weight:bold">while</span> <span style="color:#000000">(!</span><span style="color:#010181">COLOR_EQUAL</span><span style="color:#000000">(</span>pixels<span style="color:#000000">[(</span>lineSpacing <span style="color:#000000">+ (</span>charHeight<span style="color:#000000">+</span>lineSpacing<span style="color:#000000">)*</span>lineToRead<span style="color:#000000">)*</span>image<span style="color:#000000">.</span>width <span style="color:#000000">+</span> xPosToRead <span style="color:#000000">+</span> charWidth<span style="color:#000000">],</span> key<span style="color:#000000">))</span> charWidth<span style="color:#000000">++;</span>
            tempCharRecs<span style="color:#000000">[</span>index<span style="color:#000000">].</span>width <span style="color:#000000">= (</span><span style="color:#0057ae">float</span><span style="color:#000000">)</span>charWidth<span style="color:#000000">;</span>
            index<span style="color:#000000">++;</span>
            xPosToRead <span style="color:#000000">+= (</span>charWidth <span style="color:#000000">+</span> charSpacing<span style="color:#000000">);</span>
        <span style="color:#000000">}</span>
        lineToRead<span style="color:#000000">++;</span>
        xPosToRead <span style="color:#000000">=</span> charSpacing<span style="color:#000000">;</span>
    <span style="color:#000000">}</span>
    <span style="color:#838183; font-style:italic">// NOTE: We need to remove key color borders from image to avoid weird</span>
    <span style="color:#838183; font-style:italic">// artifacts on texture scaling when using TEXTURE_FILTER_BILINEAR or TEXTURE_FILTER_TRILINEAR</span>
    <span style="color:#000000; font-weight:bold">for</span> <span style="color:#000000">(</span><span style="color:#0057ae">int</span> i <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span> i <span style="color:#000000">&lt;</span> image<span style="color:#000000">.</span>height<span style="color:#000000">*</span>image<span style="color:#000000">.</span>width<span style="color:#000000">;</span> i<span style="color:#000000">++)</span> <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span><span style="color:#010181">COLOR_EQUAL</span><span style="color:#000000">(</span>pixels<span style="color:#000000">[</span>i<span style="color:#000000">],</span> key<span style="color:#000000">))</span> pixels<span style="color:#000000">[</span>i<span style="color:#000000">] =</span> BLANK<span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// Create a new image with the processed color data (key color replaced by BLANK)</span>
    Image fontClear <span style="color:#000000">= {</span>
        <span style="color:#000000">.</span>data <span style="color:#000000">=</span> pixels<span style="color:#000000">,</span>
        <span style="color:#000000">.</span>width <span style="color:#000000">=</span> image<span style="color:#000000">.</span>width<span style="color:#000000">,</span>
        <span style="color:#000000">.</span>height <span style="color:#000000">=</span> image<span style="color:#000000">.</span>height<span style="color:#000000">,</span>
        <span style="color:#000000">.</span>mipmaps <span style="color:#000000">=</span> <span style="color:#b07e00">1</span><span style="color:#000000">,</span>
        <span style="color:#000000">.</span>format <span style="color:#000000">=</span> PIXELFORMAT_UNCOMPRESSED_R8G8B8A8
    <span style="color:#000000">};</span>
    <span style="color:#838183; font-style:italic">// Set font with all data parsed from image</span>
    font<span style="color:#000000">.</span>texture <span style="color:#000000">=</span> <span style="color:#010181">LoadTextureFromImage</span><span style="color:#000000">(</span>fontClear<span style="color:#000000">);</span> <span style="color:#838183; font-style:italic">// Convert processed image to OpenGL texture</span>
    font<span style="color:#000000">.</span>glyphCount <span style="color:#000000">=</span> index<span style="color:#000000">;</span>
    font<span style="color:#000000">.</span>glyphPadding <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// We got tempCharValues and tempCharsRecs populated with chars data</span>
    <span style="color:#838183; font-style:italic">// Now we move temp data to sized charValues and charRecs arrays</span>
    font<span style="color:#000000">.</span>glyphs <span style="color:#000000">= (</span>GlyphInfo <span style="color:#000000">*)</span><span style="color:#010181">RL_MALLOC</span><span style="color:#000000">(</span>font<span style="color:#000000">.</span>glyphCount<span style="color:#000000">*</span><span style="color:#000000; font-weight:bold">sizeof</span><span style="color:#000000">(</span>GlyphInfo<span style="color:#000000">));</span>
    font<span style="color:#000000">.</span>recs <span style="color:#000000">= (</span>Rectangle <span style="color:#000000">*)</span><span style="color:#010181">RL_MALLOC</span><span style="color:#000000">(</span>font<span style="color:#000000">.</span>glyphCount<span style="color:#000000">*</span><span style="color:#000000; font-weight:bold">sizeof</span><span style="color:#000000">(</span>Rectangle<span style="color:#000000">));</span>
    <span style="color:#000000; font-weight:bold">for</span> <span style="color:#000000">(</span><span style="color:#0057ae">int</span> i <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span> i <span style="color:#000000">&lt;</span> font<span style="color:#000000">.</span>glyphCount<span style="color:#000000">;</span> i<span style="color:#000000">++)</span>
    <span style="color:#000000">{</span>
        font<span style="color:#000000">.</span>glyphs<span style="color:#000000">[</span>i<span style="color:#000000">].</span>value <span style="color:#000000">=</span> tempCharValues<span style="color:#000000">[</span>i<span style="color:#000000">];</span>
        <span style="color:#838183; font-style:italic">// Get character rectangle in the font atlas texture</span>
        font<span style="color:#000000">.</span>recs<span style="color:#000000">[</span>i<span style="color:#000000">] =</span> tempCharRecs<span style="color:#000000">[</span>i<span style="color:#000000">];</span>
        <span style="color:#838183; font-style:italic">// NOTE: On image based fonts (XNA style), character offsets and xAdvance are not required (set to 0)</span>
        font<span style="color:#000000">.</span>glyphs<span style="color:#000000">[</span>i<span style="color:#000000">].</span>offsetX <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
        font<span style="color:#000000">.</span>glyphs<span style="color:#000000">[</span>i<span style="color:#000000">].</span>offsetY <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
        font<span style="color:#000000">.</span>glyphs<span style="color:#000000">[</span>i<span style="color:#000000">].</span>advanceX <span style="color:#000000">=</span> <span style="color:#b07e00">0</span><span style="color:#000000">;</span>
        <span style="color:#838183; font-style:italic">// Fill character image data from fontClear data</span>
        font<span style="color:#000000">.</span>glyphs<span style="color:#000000">[</span>i<span style="color:#000000">].</span>image <span style="color:#000000">=</span> <span style="color:#010181">ImageFromImage</span><span style="color:#000000">(</span>fontClear<span style="color:#000000">,</span> tempCharRecs<span style="color:#000000">[</span>i<span style="color:#000000">]);</span>
    <span style="color:#000000">}</span>
    <span style="color:#010181">UnloadImage</span><span style="color:#000000">(</span>fontClear<span style="color:#000000">);</span>     <span style="color:#838183; font-style:italic">// Unload processed image once converted to texture</span>
    font<span style="color:#000000">.</span>baseSize <span style="color:#000000">= (</span><span style="color:#0057ae">int</span><span style="color:#000000">)</span>font<span style="color:#000000">.</span>recs<span style="color:#000000">[</span><span style="color:#b07e00">0</span><span style="color:#000000">].</span>height<span style="color:#000000">;</span>
    <span style="color:#000000; font-weight:bold">return</span> font<span style="color:#000000">;</span>
<span style="color:#000000">}</span>
