AudioStream <span style="color:#010181">LoadAudioStream</span><span style="color:#000000">(</span><span style="color:#0057ae">unsigned int</span> sampleRate<span style="color:#000000">,</span> <span style="color:#0057ae">unsigned int</span> sampleSize<span style="color:#000000">,</span> <span style="color:#0057ae">unsigned int</span> channels<span style="color:#000000">){</span>
    AudioStream stream <span style="color:#000000">= {</span> <span style="color:#b07e00">0</span> <span style="color:#000000">};</span>
    stream<span style="color:#000000">.</span>sampleRate <span style="color:#000000">=</span> sampleRate<span style="color:#000000">;</span>
    stream<span style="color:#000000">.</span>sampleSize <span style="color:#000000">=</span> sampleSize<span style="color:#000000">;</span>
    stream<span style="color:#000000">.</span>channels <span style="color:#000000">=</span> channels<span style="color:#000000">;</span>
    ma_format formatIn <span style="color:#000000">= ((</span>stream<span style="color:#000000">.</span>sampleSize <span style="color:#000000">==</span> <span style="color:#b07e00">8</span><span style="color:#000000">)?</span> ma_format_u8 <span style="color:#000000">: ((</span>stream<span style="color:#000000">.</span>sampleSize <span style="color:#000000">==</span> <span style="color:#b07e00">16</span><span style="color:#000000">)?</span> ma_format_s16 <span style="color:#000000">:</span> ma_format_f32<span style="color:#000000">));</span>
    <span style="color:#838183; font-style:italic">// The size of a streaming buffer must be at least double the size of a period</span>
    <span style="color:#0057ae">unsigned int</span> periodSize <span style="color:#000000">=</span> AUDIO<span style="color:#000000">.</span>System<span style="color:#000000">.</span>device<span style="color:#000000">.</span>playback<span style="color:#000000">.</span>internalPeriodSizeInFrames<span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// If the buffer is not set, compute one that would give us a buffer good enough for a decent frame rate</span>
    <span style="color:#0057ae">unsigned int</span> subBufferSize <span style="color:#000000">= (</span>AUDIO<span style="color:#000000">.</span>Buffer<span style="color:#000000">.</span>defaultSize <span style="color:#000000">==</span> <span style="color:#b07e00">0</span><span style="color:#000000">)?</span> AUDIO<span style="color:#000000">.</span>System<span style="color:#000000">.</span>device<span style="color:#000000">.</span>sampleRate<span style="color:#000000">/</span><span style="color:#b07e00">30</span> <span style="color:#000000">:</span> AUDIO<span style="color:#000000">.</span>Buffer<span style="color:#000000">.</span>defaultSize<span style="color:#000000">;</span>
    <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span>subBufferSize <span style="color:#000000">&lt;</span> periodSize<span style="color:#000000">)</span> subBufferSize <span style="color:#000000">=</span> periodSize<span style="color:#000000">;</span>
    <span style="color:#838183; font-style:italic">// Create a double audio buffer of defined size</span>
    stream<span style="color:#000000">.</span>buffer <span style="color:#000000">=</span> <span style="color:#010181">LoadAudioBuffer</span><span style="color:#000000">(</span>formatIn<span style="color:#000000">,</span> stream<span style="color:#000000">.</span>channels<span style="color:#000000">,</span> stream<span style="color:#000000">.</span>sampleRate<span style="color:#000000">,</span> subBufferSize<span style="color:#000000">*</span><span style="color:#b07e00">2</span><span style="color:#000000">,</span> AUDIO_BUFFER_USAGE_STREAM<span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span>stream<span style="color:#000000">.</span>buffer <span style="color:#000000">!=</span> NULL<span style="color:#000000">)</span>
    <span style="color:#000000">{</span>
        stream<span style="color:#000000">.</span>buffer<span style="color:#000000">-&gt;</span>looping <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">true</span><span style="color:#000000">;</span>    <span style="color:#838183; font-style:italic">// Always loop for streaming buffers</span>
        <span style="color:#010181">TRACELOG</span><span style="color:#000000">(</span>LOG_INFO<span style="color:#000000">,</span> <span style="color:#bf0303">&quot;STREAM: Initialized successfully (%i Hz, %i bit, %s)&quot;</span><span style="color:#000000">,</span> stream<span style="color:#000000">.</span>sampleRate<span style="color:#000000">,</span> stream<span style="color:#000000">.</span>sampleSize<span style="color:#000000">, (</span>stream<span style="color:#000000">.</span>channels <span style="color:#000000">==</span> <span style="color:#b07e00">1</span><span style="color:#000000">)?</span> <span style="color:#bf0303">&quot;Mono&quot;</span> <span style="color:#000000">:</span> <span style="color:#bf0303">&quot;Stereo&quot;</span><span style="color:#000000">);</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">else</span> <span style="color:#010181">TRACELOG</span><span style="color:#000000">(</span>LOG_WARNING<span style="color:#000000">,</span> <span style="color:#bf0303">&quot;STREAM: Failed to load audio buffer, stream could not be created&quot;</span><span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">return</span> stream<span style="color:#000000">;</span>
<span style="color:#000000">}</span>
